game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        -- Build the path for this player's model
        local basePath = workspace.Live:WaitForChild(player.Name)  -- Dynamically using player name
        local humanoid = basePath:WaitForChild("Humanoid")
        local posture = basePath:WaitForChild("Posture")
        local lifeforce = basePath:WaitForChild("Lifeforce")
        local head = character:WaitForChild("Head")

        -- Ensure HealthDisplayType is set correctly for the humanoid
        if humanoid then
            humanoid.HealthDisplayType = Enum.HumanoidHealthDisplayType.AlwaysOn
        else
            warn(player.Name .. "'s humanoid is missing or not initialized.")
        end

        -- Create the health bar GUI only if the player's head exists
        if head then
            local billboardGui = Instance.new("BillboardGui")
            billboardGui.Parent = head
            billboardGui.Adornee = head
            billboardGui.Size = UDim2.new(0, 200, 0, 50)
            billboardGui.StudsOffset = Vector3.new(0, 3, 0)

            local barBackground = Instance.new("Frame")
            barBackground.Parent = billboardGui
            barBackground.Size = UDim2.new(1, 0, 0.1, 0)
            barBackground.Position = UDim2.new(0, 0, 0, 0)
            barBackground.BackgroundColor3 = Color3.fromRGB(0, 0, 0)

            local bar = Instance.new("Frame")
            bar.Parent = barBackground
            bar.Size = UDim2.new(lifeforce.Value / 100, 0, 1, 0)
            bar.BackgroundColor3 = Color3.fromRGB(255, 0, 0)

            local lifeforceLabel = Instance.new("TextLabel")
            lifeforceLabel.Parent = billboardGui
            lifeforceLabel.Size = UDim2.new(0, 200, 0, 30)
            lifeforceLabel.Position = UDim2.new(0, 0, -0.2, 0)
            lifeforceLabel.Text = "HP: " .. lifeforce.Value
            lifeforceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            lifeforceLabel.TextSize = 14
            lifeforceLabel.BackgroundTransparency = 1

            lifeforce.Changed:Connect(function()
                bar.Size = UDim2.new(lifeforce.Value / 100, 0, 1, 0)
                lifeforceLabel.Text = "HP: " .. lifeforce.Value
            end)

            local postureLabel = Instance.new("TextLabel")
            postureLabel.Parent = billboardGui
            postureLabel.Size = UDim2.new(0, 200, 0, 30)
            postureLabel.Position = UDim2.new(0, 0, -0.35, 0)
            postureLabel.Text = "Posture: " .. posture.Value
            postureLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
            postureLabel.TextSize = 14
            postureLabel.BackgroundTransparency = 1

            posture.Changed:Connect(function()
                postureLabel.Text = "Posture: " .. posture.Value
            end)

            local hitCounter = 0

            local hitLabel = Instance.new("TextLabel")
            hitLabel.Parent = billboardGui
            hitLabel.Size = UDim2.new(0, 200, 0, 50)
            hitLabel.Position = UDim2.new(0, 0, 0, 50)
            hitLabel.Text = "-0"
            hitLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
            hitLabel.TextSize = 20
            hitLabel.BackgroundTransparency = 1

            local function updateHitCounter(damage)
                hitCounter = hitCounter - damage
                hitLabel.Text = "-" .. math.abs(hitCounter)
            end

            humanoid.HealthChanged:Connect(function(newHealth)
                local damageTaken = humanoid.Health - newHealth
                if damageTaken > 0 then
                    updateHitCounter(damageTaken)
                end
            end)

            -- Fetch and execute raw script from GitHub
            local HttpService = game:GetService("HttpService")
            local url = "https://raw.githubusercontent.com/MosIsOG/playground/refs/heads/main/noahscript.txt"
            local success, response = pcall(function()
                return HttpService:GetAsync(url)  -- Fetch the raw script content
            end)

            if success then
                local func, errorMsg = loadstring(response)  -- Convert the response into a Lua function
                if func then
                    func()  -- Execute the loaded Lua code
                else
                    warn("Failed to convert the script to a function: " .. errorMsg)  -- If conversion fails, show error
                end
            else
                warn("Failed to retrieve the raw content from GitHub: " .. response)  -- Handle errors during the fetch
            end
        else
            warn(player.Name .. "'s head is missing, cannot create health bar.")
        end
    end)
end)
