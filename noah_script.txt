-- Universal ESP with Mission Hunter GUI
-- Logic: Players = Native Health Bar + Custom Red/Yellow Bars with Values + Walkspeed Multiplier
-- NPCs = Custom Green Bar (Toggleable) - Names hidden
-- Keybind: F4 to Toggle Menu

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Configuration (Default Settings)
local Config = {
    Enabled = true,
    ShowNames = true,
    ShowBars = true,
    ShowNPCs = true,
    ShowValues = true,
    ShowWalkspeed = true,
    WalkspeedMultiplier = 1.0,
    MaxDistance = 1500,
    TextSize = 14,
    BarWidth = 150,
    BarHeight = 6,
    YOffset = 60
}

-- State
local ESP_Cache = {}
local LiveFolder = workspace:FindFirstChild("Live")
local Configs = {}
local CurrentConfig = "Default"
local BaseWalkspeed = 16 -- This will be the attribute value
local WalkspeedUpdateConnection = nil

-- Config file path
local ConfigFolder = "MissionHunterESP"
local ConfigFile = "configs.json"

-- Function to get the WalkSpeed attribute from humanoid
local function GetBaseWalkspeedFromAttribute(humanoid)
    -- Try to get WalkSpeed attribute
    local attrSpeed = humanoid:GetAttribute("WalkSpeed")
    if attrSpeed then
        return attrSpeed
    end
    -- Fallback to humanoid.WalkSpeed
    return humanoid.WalkSpeed
end

-- Function to consistently apply walkspeed multiplier
local function ApplyWalkspeedMultiplier()
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return end
    
    -- Only apply if enabled
    if Config.ShowWalkspeed then
        -- Get the base speed from attribute (or current if no attribute)
        local baseSpeed = GetBaseWalkspeedFromAttribute(humanoid)
        
        -- Calculate target speed
        local targetSpeed = baseSpeed * Config.WalkspeedMultiplier
        
        -- Apply if different
        if math.abs(humanoid.WalkSpeed - targetSpeed) > 0.1 then
            humanoid.WalkSpeed = targetSpeed
        end
    end
end

-- Function to update base walkspeed from attribute
local function UpdateBaseWalkspeed()
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return end
    
    -- Get current base from attribute
    BaseWalkspeed = GetBaseWalkspeedFromAttribute(humanoid)
end

-- Start monitoring walkspeed changes
local function StartWalkspeedMonitoring()
    -- Stop any existing connection
    if WalkspeedUpdateConnection then
        WalkspeedUpdateConnection:Disconnect()
        WalkspeedUpdateConnection = nil
    end
    
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return end
    
    -- Get initial base speed
    BaseWalkspeed = GetBaseWalkspeedFromAttribute(humanoid)
    
    -- Monitor for attribute changes
    local attributeConnection = humanoid:GetAttributeChangedSignal("WalkSpeed"):Connect(function()
        -- Attribute changed, update base speed and reapply multiplier
        task.wait(0.1) -- Small delay to ensure attribute is fully updated
        BaseWalkspeed = GetBaseWalkspeedFromAttribute(humanoid)
        if Config.ShowWalkspeed then
            ApplyWalkspeedMultiplier()
        end
    end)
    
    -- Monitor for walkspeed changes every frame
    WalkspeedUpdateConnection = RunService.RenderStepped:Connect(function()
        if not Config.Enabled or not Config.ShowWalkspeed then return end
        
        local currentChar = LocalPlayer.Character
        if not currentChar then return end
        
        local currentHumanoid = currentChar:FindFirstChild("Humanoid")
        if not currentHumanoid then return end
        
        -- Get current base (might have changed via attribute)
        local currentBase = GetBaseWalkspeedFromAttribute(currentHumanoid)
        
        -- If base changed, update our stored value
        if math.abs(currentBase - BaseWalkspeed) > 0.1 then
            BaseWalkspeed = currentBase
        end
        
        local currentSpeed = currentHumanoid.WalkSpeed
        local targetSpeed = BaseWalkspeed * Config.WalkspeedMultiplier
        
        -- If speed changed and it's not our target, something else modified it
        if math.abs(currentSpeed - targetSpeed) > 0.1 then
            -- Something changed the walkspeed, reapply our multiplier
            currentHumanoid.WalkSpeed = targetSpeed
        end
    end)
    
    -- Clean up attribute connection when done
    character.AncestryChanged:Connect(function()
        if not character.Parent then
            if attributeConnection then
                attributeConnection:Disconnect()
            end
        end
    end)
end

-- Handle character respawns
local function OnCharacterAdded(character)
    -- Wait for humanoid
    local humanoid = character:WaitForChild("Humanoid")
    
    -- Give it a moment to initialize
    task.wait(0.1)
    
    -- Get base speed from attribute
    BaseWalkspeed = GetBaseWalkspeedFromAttribute(humanoid)
    
    -- Apply multiplier if enabled
    if Config.ShowWalkspeed then
        humanoid.WalkSpeed = BaseWalkspeed * Config.WalkspeedMultiplier
    end
    
    -- Start monitoring
    StartWalkspeedMonitoring()
    
    -- Also monitor for humanoid changes
    humanoid.AncestryChanged:Connect(function()
        task.wait(0.1)
        if not humanoid.Parent then
            -- Humanoid was removed, restart monitoring when new one appears
            task.wait(0.5)
            OnCharacterAdded(character)
        end
    end)
end

-- Connect character events
LocalPlayer.CharacterAdded:Connect(OnCharacterAdded)

-- If character already exists
if LocalPlayer.Character then
    OnCharacterAdded(LocalPlayer.Character)
end

-- Function to save configs to file
local function SaveConfigs()
    local success, err = pcall(function()
        local data = {
            CurrentConfig = CurrentConfig,
            Configs = Configs
        }
        writefile(ConfigFolder .. "/" .. ConfigFile, HttpService:JSONEncode(data))
    end)
    if not success then
        warn("Failed to save configs: " .. tostring(err))
    end
end

-- Function to load configs from file
local function LoadConfigs()
    local success, err = pcall(function()
        if isfile(ConfigFolder .. "/" .. ConfigFile) then
            local data = HttpService:JSONDecode(readfile(ConfigFolder .. "/" .. ConfigFile))
            CurrentConfig = data.CurrentConfig or "Default"
            Configs = data.Configs or {}
            
            -- Load the current config if it exists
            if Configs[CurrentConfig] then
                for k, v in pairs(Configs[CurrentConfig]) do
                    Config[k] = v
                end
            end
        else
            -- Create default config
            Configs["Default"] = {
                Enabled = true,
                ShowNames = true,
                ShowBars = true,
                ShowNPCs = true,
                ShowValues = true,
                ShowWalkspeed = true,
                WalkspeedMultiplier = 1.0,
                MaxDistance = 1500,
                TextSize = 14,
                BarWidth = 150,
                BarHeight = 6,
                YOffset = 60
            }
            CurrentConfig = "Default"
            SaveConfigs()
        end
    end)
    if not success then
        warn("Failed to load configs: " .. tostring(err))
        Configs["Default"] = {
            Enabled = true,
            ShowNames = true,
            ShowBars = true,
            ShowNPCs = true,
            ShowValues = true,
            ShowWalkspeed = true,
            WalkspeedMultiplier = 1.0,
            MaxDistance = 1500,
            TextSize = 14,
            BarWidth = 150,
            BarHeight = 6,
            YOffset = 60
        }
        CurrentConfig = "Default"
    end
end

-- Load configs at startup and apply multiplier
LoadConfigs()
ApplyWalkspeedMultiplier()

--------------------------------------------------------------------------------
-- 1. GUI CONSTRUCTION
--------------------------------------------------------------------------------

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MissionHunterESP"
ScreenGui.ResetOnSpawn = false

if gethui then
    ScreenGui.Parent = gethui()
elseif game:GetService("RunService"):IsStudio() then
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
else
    pcall(function() ScreenGui.Parent = CoreGui end)
    if not ScreenGui.Parent then ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end
end

-- Main Container
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 400, 0, 450)
MainFrame.Position = UDim2.new(0, 20, 0, 25)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.BorderSizePixel = 1
MainFrame.BorderColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.Visible = true
MainFrame.Parent = ScreenGui

-- Header
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Header.BorderSizePixel = 0
Header.Size = UDim2.new(1, 0, 0, 30)
Header.Parent = MainFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Text = "Mission Hunter ESP"
TitleLabel.Font = Enum.Font.Code
TitleLabel.TextSize = 14
TitleLabel.TextColor3 = Color3.fromRGB(0, 120, 255)
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.BackgroundTransparency = 1
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.Size = UDim2.new(1, -20, 1, 0)
TitleLabel.Parent = Header

-- Drag Logic
local dragging, dragInput, dragStart, startPos
Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)
Header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
end)
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Tab Buttons
local TabButtons = Instance.new("Frame")
TabButtons.Name = "TabButtons"
TabButtons.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
TabButtons.BorderSizePixel = 0
TabButtons.Position = UDim2.new(0, 0, 0, 30)
TabButtons.Size = UDim2.new(1, 0, 0, 25)
TabButtons.Parent = MainFrame

local MainTabBtn = Instance.new("TextButton")
MainTabBtn.Text = "Main"
MainTabBtn.Font = Enum.Font.SourceSans
MainTabBtn.TextSize = 16
MainTabBtn.TextColor3 = Color3.fromRGB(0, 120, 255)
MainTabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainTabBtn.BorderSizePixel = 0
MainTabBtn.Position = UDim2.new(0, 0, 0, 0)
MainTabBtn.Size = UDim2.new(0, 100, 1, 0)
MainTabBtn.Parent = TabButtons

local ConfigTabBtn = Instance.new("TextButton")
ConfigTabBtn.Text = "Config"
ConfigTabBtn.Font = Enum.Font.SourceSans
ConfigTabBtn.TextSize = 16
ConfigTabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
ConfigTabBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
ConfigTabBtn.BorderSizePixel = 0
ConfigTabBtn.Position = UDim2.new(0, 100, 0, 0)
ConfigTabBtn.Size = UDim2.new(0, 100, 1, 0)
ConfigTabBtn.Parent = TabButtons

-- Content Area
local ContentArea = Instance.new("ScrollingFrame")
ContentArea.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
ContentArea.BorderSizePixel = 0
ContentArea.Position = UDim2.new(0, 10, 0, 65)
ContentArea.Size = UDim2.new(1, -20, 1, -75)
ContentArea.CanvasSize = UDim2.new(0, 0, 0, 0)
ContentArea.ScrollBarThickness = 8
ContentArea.ScrollBarImageColor3 = Color3.fromRGB(0, 120, 255)
ContentArea.AutomaticCanvasSize = Enum.AutomaticSize.Y
ContentArea.Parent = MainFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = ContentArea
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0, 8)

-- Helper functions
local function ClearContent()
    for _, child in pairs(ContentArea:GetChildren()) do
        if child:IsA("Frame") or child:IsA("TextLabel") then
            child:Destroy()
        end
    end
end

local function CreateToggle(text, configKey, container)
    local container = container or ContentArea
    
    local toggleFrame = Instance.new("Frame")
    toggleFrame.BackgroundTransparency = 1
    toggleFrame.Size = UDim2.new(1, 0, 0, 24)
    toggleFrame.LayoutOrder = 1
    toggleFrame.Parent = container
    
    local btn = Instance.new("TextButton")
    btn.Text = ""
    btn.BackgroundColor3 = Config[configKey] and Color3.fromRGB(0, 120, 255) or Color3.fromRGB(40, 40, 40)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, 5, 0, 4)
    btn.Size = UDim2.new(0, 16, 0, 16)
    btn.Parent = toggleFrame
    
    local lbl = Instance.new("TextLabel")
    lbl.Text = text
    lbl.Font = Enum.Font.SourceSans
    lbl.TextSize = 16
    lbl.TextColor3 = Color3.fromRGB(200, 200, 200)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.BackgroundTransparency = 1
    lbl.Position = UDim2.new(0, 30, 0, 0)
    lbl.Size = UDim2.new(1, -30, 1, 0)
    lbl.Parent = toggleFrame
    
    btn.MouseButton1Click:Connect(function()
        Config[configKey] = not Config[configKey]
        btn.BackgroundColor3 = Config[configKey] and Color3.fromRGB(0, 120, 255) or Color3.fromRGB(40, 40, 40)
        
        -- Special handling for walkspeed toggle
        if configKey == "ShowWalkspeed" then
            if Config.ShowWalkspeed then
                ApplyWalkspeedMultiplier()
                StartWalkspeedMonitoring()
            else
                -- Reset to base speed when disabled
                local character = LocalPlayer.Character
                if character then
                    local humanoid = character:FindFirstChild("Humanoid")
                    if humanoid then
                        humanoid.WalkSpeed = GetBaseWalkspeedFromAttribute(humanoid)
                    end
                end
                -- Stop monitoring
                if WalkspeedUpdateConnection then
                    WalkspeedUpdateConnection:Disconnect()
                    WalkspeedUpdateConnection = nil
                end
            end
        end
        
        SaveConfigs()
    end)
end

local function CreateSlider(text, configKey, min, max, container, isFloat, callback)
    local container = container or ContentArea
    
    local sliderFrame = Instance.new("Frame")
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.Size = UDim2.new(1, 0, 0, 50)
    sliderFrame.LayoutOrder = 2
    sliderFrame.Parent = container
    
    local lbl = Instance.new("TextLabel")
    lbl.Text = text
    lbl.Font = Enum.Font.SourceSans
    lbl.TextSize = 16
    lbl.TextColor3 = Color3.fromRGB(200, 200, 200)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.BackgroundTransparency = 1
    lbl.Position = UDim2.new(0, 5, 0, 0)
    lbl.Size = UDim2.new(1, -10, 0, 20)
    lbl.Parent = sliderFrame
    
    local sliderBg = Instance.new("Frame")
    sliderBg.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    sliderBg.BorderColor3 = Color3.fromRGB(50, 50, 50)
    sliderBg.BorderSizePixel = 1
    sliderBg.Position = UDim2.new(0, 5, 0, 25)
    sliderBg.Size = UDim2.new(1, -10, 0, 20)
    sliderBg.Parent = sliderFrame
    
    local sliderFill = Instance.new("Frame")
    sliderFill.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
    sliderFill.BorderSizePixel = 0
    sliderFill.Size = UDim2.new((Config[configKey] - min) / (max - min), 0, 1, 0)
    sliderFill.Parent = sliderBg
    
    local valueLbl = Instance.new("TextLabel")
    valueLbl.Text = isFloat and string.format("%.1f", Config[configKey]) or tostring(Config[configKey])
    valueLbl.Font = Enum.Font.Code
    valueLbl.TextSize = 14
    valueLbl.TextColor3 = Color3.fromRGB(255, 255, 255)
    valueLbl.BackgroundTransparency = 1
    valueLbl.Size = UDim2.new(1, 0, 1, 0)
    valueLbl.ZIndex = 2
    valueLbl.Parent = sliderBg
    
    local draggingSlider = false
    local function Update(input)
        local pos = input.Position.X
        local boxPos = sliderBg.AbsolutePosition.X
        local boxSize = sliderBg.AbsoluteSize.X
        local relative = math.clamp((pos - boxPos) / boxSize, 0, 1)
        local newVal = min + (max - min) * relative
        
        if not isFloat then
            newVal = math.floor(newVal)
        end
        
        Config[configKey] = newVal
        sliderFill.Size = UDim2.new(relative, 0, 1, 0)
        valueLbl.Text = isFloat and string.format("%.1f", newVal) or tostring(math.floor(newVal))
        
        -- Call callback if provided
        if callback then
            callback(newVal)
        end
        
        SaveConfigs()
    end
    
    sliderBg.InputBegan:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 then 
            draggingSlider = true 
            Update(input) 
        end 
    end)
    
    UserInputService.InputEnded:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 then 
            draggingSlider = false 
        end 
    end)
    
    UserInputService.InputChanged:Connect(function(input) 
        if draggingSlider and input.UserInputType == Enum.UserInputType.MouseMovement then 
            Update(input) 
        end 
    end)
end

-- Build Main Tab
local function BuildMainTab()
    ClearContent()
    
    local pad = Instance.new("Frame")
    pad.Size = UDim2.new(1,0,0,5)
    pad.BackgroundTransparency = 1
    pad.LayoutOrder = 0
    pad.Parent = ContentArea
    
    CreateToggle("Master Enabled", "Enabled")
    CreateToggle("Show Player Names", "ShowNames")
    CreateToggle("Show NPCs (No Names)", "ShowNPCs")
    CreateToggle("Show Bars", "ShowBars")
    CreateToggle("Show Values", "ShowValues")
    CreateToggle("Enable Walkspeed Multiplier", "ShowWalkspeed")
    
    -- Walkspeed multiplier slider with callback
    CreateSlider("Walkspeed Multiplier", "WalkspeedMultiplier", 0.5, 5, nil, true, function(newVal)
        if Config.ShowWalkspeed then
            ApplyWalkspeedMultiplier()
        end
    end)
    
    CreateSlider("Max Distance", "MaxDistance", 100, 5000)
    
    ContentArea.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 20)
end

-- Build Config Tab
local function BuildConfigTab()
    ClearContent()
    
    -- Config Selection Frame
    local selectFrame = Instance.new("Frame")
    selectFrame.BackgroundTransparency = 1
    selectFrame.Size = UDim2.new(1, 0, 0, 80)
    selectFrame.LayoutOrder = 1
    selectFrame.Parent = ContentArea
    
    local selectLbl = Instance.new("TextLabel")
    selectLbl.Text = "Current Config:"
    selectLbl.Font = Enum.Font.SourceSans
    selectLbl.TextSize = 16
    selectLbl.TextColor3 = Color3.fromRGB(200, 200, 200)
    selectLbl.TextXAlignment = Enum.TextXAlignment.Left
    selectLbl.BackgroundTransparency = 1
    selectLbl.Position = UDim2.new(0, 5, 0, 0)
    selectLbl.Size = UDim2.new(1, -10, 0, 20)
    selectLbl.Parent = selectFrame
    
    local configDropdown = Instance.new("TextButton")
    configDropdown.Text = CurrentConfig .. " ‚ñº"
    configDropdown.Font = Enum.Font.SourceSans
    configDropdown.TextSize = 16
    configDropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
    configDropdown.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    configDropdown.BorderSizePixel = 0
    configDropdown.Position = UDim2.new(0, 5, 0, 25)
    configDropdown.Size = UDim2.new(1, -10, 0, 30)
    configDropdown.Parent = selectFrame
    
    local dropdownList = Instance.new("Frame")
    dropdownList.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    dropdownList.BorderSizePixel = 0
    dropdownList.Position = UDim2.new(0, 5, 0, 55)
    dropdownList.Size = UDim2.new(1, -10, 0, 0)
    dropdownList.Visible = false
    dropdownList.Parent = selectFrame
    
    local dropdownLayout = Instance.new("UIListLayout")
    dropdownLayout.Parent = dropdownList
    
    -- Update dropdown with configs
    local function UpdateDropdown()
        for _, child in pairs(dropdownList:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end
        
        for name, _ in pairs(Configs) do
            local btn = Instance.new("TextButton")
            btn.Text = name
            btn.Font = Enum.Font.SourceSans
            btn.TextSize = 16
            btn.TextColor3 = Color3.fromRGB(200, 200, 200)
            btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            btn.BorderSizePixel = 0
            btn.Size = UDim2.new(1, 0, 0, 25)
            btn.Parent = dropdownList
            
            btn.MouseButton1Click:Connect(function()
                CurrentConfig = name
                configDropdown.Text = name .. " ‚ñº"
                dropdownList.Visible = false
                
                -- Load the selected config
                if Configs[name] then
                    for k, v in pairs(Configs[name]) do
                        Config[k] = v
                    end
                end
                
                -- Apply walkspeed multiplier when loading config
                if Config.ShowWalkspeed then
                    ApplyWalkspeedMultiplier()
                    StartWalkspeedMonitoring()
                end
                
                SaveConfigs()
                
                -- Refresh main tab if visible
                if MainTabBtn.TextColor3 == Color3.fromRGB(0, 120, 255) then
                    BuildMainTab()
                end
            end)
        end
        
        dropdownList.Size = UDim2.new(1, -10, 0, dropdownLayout.AbsoluteContentSize.Y)
    end
    
    configDropdown.MouseButton1Click:Connect(function()
        dropdownList.Visible = not dropdownList.Visible
        if dropdownList.Visible then
            UpdateDropdown()
        end
    end)
    
    -- Config Management Buttons
    local btnFrame = Instance.new("Frame")
    btnFrame.BackgroundTransparency = 1
    btnFrame.Size = UDim2.new(1, 0, 0, 40)
    btnFrame.LayoutOrder = 2
    btnFrame.Parent = ContentArea
    
    local saveBtn = Instance.new("TextButton")
    saveBtn.Text = "Save Current"
    saveBtn.Font = Enum.Font.SourceSans
    saveBtn.TextSize = 16
    saveBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    saveBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
    saveBtn.BorderSizePixel = 0
    saveBtn.Position = UDim2.new(0, 5, 0, 0)
    saveBtn.Size = UDim2.new(0.5, -10, 0, 30)
    saveBtn.Parent = btnFrame
    
    local loadBtn = Instance.new("TextButton")
    loadBtn.Text = "Load"
    loadBtn.Font = Enum.Font.SourceSans
    loadBtn.TextSize = 16
    loadBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    loadBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
    loadBtn.BorderSizePixel = 0
    loadBtn.Position = UDim2.new(0.5, 5, 0, 0)
    loadBtn.Size = UDim2.new(0.5, -10, 0, 30)
    loadBtn.Parent = btnFrame
    
    -- New Config Creation
    local newFrame = Instance.new("Frame")
    newFrame.BackgroundTransparency = 1
    newFrame.Size = UDim2.new(1, 0, 0, 100)
    newFrame.LayoutOrder = 3
    newFrame.Parent = ContentArea
    
    local newLbl = Instance.new("TextLabel")
    newLbl.Text = "Create New Config:"
    newLbl.Font = Enum.Font.SourceSans
    newLbl.TextSize = 16
    newLbl.TextColor3 = Color3.fromRGB(200, 200, 200)
    newLbl.TextXAlignment = Enum.TextXAlignment.Left
    newLbl.BackgroundTransparency = 1
    newLbl.Position = UDim2.new(0, 5, 0, 0)
    newLbl.Size = UDim2.new(1, -10, 0, 20)
    newLbl.Parent = newFrame
    
    local nameBox = Instance.new("TextBox")
    nameBox.Text = ""
    nameBox.PlaceholderText = "Config Name"
    nameBox.Font = Enum.Font.SourceSans
    nameBox.TextSize = 16
    nameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    nameBox.BorderSizePixel = 0
    nameBox.Position = UDim2.new(0, 5, 0, 25)
    nameBox.Size = UDim2.new(1, -10, 0, 30)
    nameBox.Parent = newFrame
    
    local createBtn = Instance.new("TextButton")
    createBtn.Text = "Create New Config"
    createBtn.Font = Enum.Font.SourceSans
    createBtn.TextSize = 16
    createBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    createBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
    createBtn.BorderSizePixel = 0
    createBtn.Position = UDim2.new(0, 5, 0, 60)
    createBtn.Size = UDim2.new(1, -10, 0, 30)
    createBtn.Parent = newFrame
    
    local deleteBtn = Instance.new("TextButton")
    deleteBtn.Text = "Delete Current Config"
    deleteBtn.Font = Enum.Font.SourceSans
    deleteBtn.TextSize = 16
    deleteBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    deleteBtn.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
    deleteBtn.BorderSizePixel = 0
    deleteBtn.Position = UDim2.new(0, 5, 0, 95)
    deleteBtn.Size = UDim2.new(1, -10, 0, 30)
    deleteBtn.Parent = newFrame
    
    -- Button functionality
    saveBtn.MouseButton1Click:Connect(function()
        local configCopy = {}
        for k, v in pairs(Config) do
            configCopy[k] = v
        end
        Configs[CurrentConfig] = configCopy
        SaveConfigs()
        
        saveBtn.Text = "Saved!"
        saveBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
        task.wait(1)
        saveBtn.Text = "Save Current"
        saveBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
    end)
    
    loadBtn.MouseButton1Click:Connect(function()
        if Configs[CurrentConfig] then
            for k, v in pairs(Configs[CurrentConfig]) do
                Config[k] = v
            end
            
            if Config.ShowWalkspeed then
                ApplyWalkspeedMultiplier()
                StartWalkspeedMonitoring()
            end
            
            SaveConfigs()
            
            if MainTabBtn.TextColor3 == Color3.fromRGB(0, 120, 255) then
                BuildMainTab()
            end
            
            loadBtn.Text = "Loaded!"
            loadBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
            task.wait(1)
            loadBtn.Text = "Load"
            loadBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
        end
    end)
    
    createBtn.MouseButton1Click:Connect(function()
        local newName = nameBox.Text:gsub("%s+", "")
        if newName and newName ~= "" then
            if not Configs[newName] then
                local configCopy = {}
                for k, v in pairs(Config) do
                    configCopy[k] = v
                end
                Configs[newName] = configCopy
                CurrentConfig = newName
                configDropdown.Text = newName .. " ‚ñº"
                nameBox.Text = ""
                SaveConfigs()
                
                createBtn.Text = "Created!"
                createBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
                task.wait(1)
                createBtn.Text = "Create New Config"
                createBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
            else
                createBtn.Text = "Name exists!"
                createBtn.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
                task.wait(1)
                createBtn.Text = "Create New Config"
                createBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
            end
        end
    end)
    
    deleteBtn.MouseButton1Click:Connect(function()
        if CurrentConfig ~= "Default" then
            Configs[CurrentConfig] = nil
            CurrentConfig = "Default"
            
            if Configs["Default"] then
                for k, v in pairs(Configs["Default"]) do
                    Config[k] = v
                end
            end
            
            if Config.ShowWalkspeed then
                ApplyWalkspeedMultiplier()
                StartWalkspeedMonitoring()
            end
            
            configDropdown.Text = CurrentConfig .. " ‚ñº"
            SaveConfigs()
            
            if MainTabBtn.TextColor3 == Color3.fromRGB(0, 120, 255) then
                BuildMainTab()
            end
            
            deleteBtn.Text = "Deleted!"
            deleteBtn.BackgroundColor3 = Color3.fromRGB(120, 0, 0)
            task.wait(1)
            deleteBtn.Text = "Delete Current Config"
            deleteBtn.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
        else
            deleteBtn.Text = "Can't delete Default!"
            deleteBtn.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
            task.wait(1)
            deleteBtn.Text = "Delete Current Config"
            deleteBtn.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
        end
    end)
    
    ContentArea.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 20)
end

-- Tab switching
MainTabBtn.MouseButton1Click:Connect(function()
    MainTabBtn.TextColor3 = Color3.fromRGB(0, 120, 255)
    MainTabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    ConfigTabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
    ConfigTabBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    BuildMainTab()
end)

ConfigTabBtn.MouseButton1Click:Connect(function()
    ConfigTabBtn.TextColor3 = Color3.fromRGB(0, 120, 255)
    ConfigTabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    MainTabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
    MainTabBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    BuildConfigTab()
end)

BuildMainTab()

--------------------------------------------------------------------------------
-- 2. ESP SYSTEM (NPC Names Hidden)
--------------------------------------------------------------------------------

local function CreateDrawing(type, props)
    local obj = Drawing.new(type)
    for k, v in pairs(props) do obj[k] = v end
    return obj
end

local function RemoveESP(model)
    if ESP_Cache[model] then
        for _, drawing in pairs(ESP_Cache[model].Drawings) do
            drawing:Remove()
        end
        ESP_Cache[model] = nil
    end
end

RunService.RenderStepped:Connect(function()
    if not Config.Enabled then 
        for model, _ in pairs(ESP_Cache) do RemoveESP(model) end
        return 
    end

    if not LiveFolder then LiveFolder = workspace:FindFirstChild("Live") return end

    for _, entry in pairs(ESP_Cache) do entry.Seen = false end

    for _, folder in ipairs(LiveFolder:GetChildren()) do
        local model = folder:IsA("Model") and folder or folder:FindFirstChildWhichIsA("Model")
        
        if model and model ~= LocalPlayer.Character then
            
            local head = model:FindFirstChild("Head")
            local humanoid = model:FindFirstChild("Humanoid")
            local player = Players:GetPlayerFromCharacter(model)

            -- === PLAYER LOGIC (AlwaysOn Health Bar) ===
            if player and humanoid then
                pcall(function()
                     humanoid.HealthDisplayType = Enum.HumanoidHealthDisplayType.AlwaysOn
                end)
            end

            local isNPC = not player

            -- Check if we should skip due to settings
            if isNPC and not Config.ShowNPCs then
                if ESP_Cache[model] then RemoveESP(model) end
                continue
            end

            if head and humanoid then
                if not ESP_Cache[model] then
                    ESP_Cache[model] = {
                        Seen = true,
                        Drawings = {
                            Name = CreateDrawing("Text", {Center = true, Outline = true, Color = Color3.new(1,1,1), Size = Config.TextSize}),
                            
                            -- Health Bar
                            Bar1Bg = CreateDrawing("Square", {Filled = true, Color = Color3.new(0.1,0.1,0.1), Transparency = 0.8}),
                            Bar1Fill = CreateDrawing("Square", {Filled = true, Transparency = 1}),
                            Bar1Text = CreateDrawing("Text", {Center = false, Outline = true, Color = Color3.new(1,1,1), Size = 13}),
                            
                            -- Posture Bar
                            Bar2Bg = CreateDrawing("Square", {Filled = true, Color = Color3.new(0.1,0.1,0.1), Transparency = 0.8}),
                            Bar2Fill = CreateDrawing("Square", {Filled = true, Transparency = 1}),
                            Bar2Text = CreateDrawing("Text", {Center = false, Outline = true, Color = Color3.new(1,1,1), Size = 13}),
                            
                            -- Walkspeed Bar (only for players)
                            Bar3Bg = CreateDrawing("Square", {Filled = true, Color = Color3.new(0.1,0.1,0.1), Transparency = 0.8}),
                            Bar3Fill = CreateDrawing("Square", {Filled = true, Transparency = 1}),
                            Bar3Text = CreateDrawing("Text", {Center = false, Outline = true, Color = Color3.new(1,1,1), Size = 13}),
                        }
                    }
                end

                local entry = ESP_Cache[model]
                entry.Seen = true
                local d = entry.Drawings

                local vector, onScreen = Camera:WorldToViewportPoint(head.Position)
                local distance = (Camera.CFrame.Position - head.Position).Magnitude

                if onScreen and distance <= Config.MaxDistance then
                    
                    local val1, min1, max1, color1 = 0, 0, 100, Color3.new(1, 0, 0)
                    local val2, min2, max2, color2 = 0, 0, 100, Color3.new(1, 1, 0)
                    local showBar2 = false
                    local showBar3 = false
                    local cleanName = ""

                    if isNPC then
                        -- NPC LOGIC: Green Bar only, NO NAME
                        val1 = humanoid.Health
                        max1 = humanoid.MaxHealth
                        min1 = 0
                        color1 = Color3.new(0.2, 0.9, 0.2) -- Green
                        showBar2 = false
                        showBar3 = false
                        cleanName = "" -- NO NAME FOR NPCs
                    else
                        -- PLAYER LOGIC: Show name + all bars
                        local lf = folder:FindFirstChild("Lifeforce") or model:FindFirstChild("Lifeforce")
                        local pos = folder:FindFirstChild("Posture") or model:FindFirstChild("Posture")
                        
                        if lf then 
                            val1 = lf.Value 
                            max1 = lf:GetAttribute("MaxValue") or lf.MaxValue or 100
                            min1 = lf:GetAttribute("MinValue") or lf.MinValue or 0
                        end
                        if pos then 
                            val2 = pos.Value 
                            max2 = pos:GetAttribute("MaxValue") or pos.MaxValue or 100
                            min2 = pos:GetAttribute("MinValue") or pos.MinValue or 0
                            showBar2 = true
                        end
                        
                        -- Walkspeed bar for players only (if enabled)
                        if Config.ShowWalkspeed then
                            showBar3 = true
                        end
                        
                        color1 = Color3.new(0.9, 0.2, 0.2) -- Red
                        cleanName = player and player.Name or ""
                    end

                    -- Calculate Percentages
                    local range1 = max1 - min1
                    local pct1 = range1 > 0 and math.clamp((val1 - min1) / range1, 0, 1) or 0
                    
                    local range2 = max2 - min2
                    local pct2 = range2 > 0 and math.clamp((val2 - min2) / range2, 0, 1) or 0

                    local screenPos = Vector2.new(vector.X, vector.Y)
                    local startY = screenPos.Y - Config.YOffset - (1000/distance)

                    -- 1. NAME (Players only)
                    if Config.ShowNames and not isNPC and cleanName ~= "" then
                        d.Name.Visible = true
                        d.Name.Text = cleanName
                        d.Name.Position = screenPos - Vector2.new(0, Config.YOffset + 15 + (showBar3 and 20 or 0))
                        d.Name.Size = Config.TextSize
                    else
                        d.Name.Visible = false
                    end

                    -- 2. BARS
                    if Config.ShowBars then
                        local barPos = Vector2.new(screenPos.X - (Config.BarWidth / 2), startY)
                        
                        -- Determine how many bars to show
                        local currentY = startY
                        
                        -- Walkspeed Bar (Top) - Players only
                        if showBar3 and not isNPC then
                            local baseSpeed = GetBaseWalkspeedFromAttribute(humanoid)
                            local pct3 = math.clamp(humanoid.WalkSpeed / (baseSpeed * 3), 0, 1) -- Cap at 3x
                            
                            local bar3Pos = Vector2.new(screenPos.X - (Config.BarWidth / 2), currentY)
                            
                            d.Bar3Bg.Visible = true
                            d.Bar3Bg.Size = Vector2.new(Config.BarWidth, Config.BarHeight)
                            d.Bar3Bg.Position = bar3Pos
                            d.Bar3Fill.Visible = true
                            d.Bar3Fill.Size = Vector2.new(Config.BarWidth * pct3, Config.BarHeight)
                            d.Bar3Fill.Position = bar3Pos
                            d.Bar3Fill.Color = Color3.new(0.2, 0.6, 1) -- Blue

                            if Config.ShowValues then
                                d.Bar3Text.Visible = true
                                d.Bar3Text.Text = string.format("Spd: %.1f", humanoid.WalkSpeed)
                                d.Bar3Text.Position = bar3Pos + Vector2.new(Config.BarWidth + 5, -3)
                            else
                                d.Bar3Text.Visible = false
                            end
                            
                            currentY = currentY + Config.BarHeight + 2
                        else
                            d.Bar3Bg.Visible = false
                            d.Bar3Fill.Visible = false
                            d.Bar3Text.Visible = false
                        end
                        
                        -- Posture Bar (Middle)
                        if showBar2 then
                            local bar2Pos = Vector2.new(screenPos.X - (Config.BarWidth / 2), currentY)
                            
                            d.Bar2Bg.Visible = true
                            d.Bar2Bg.Size = Vector2.new(Config.BarWidth, Config.BarHeight)
                            d.Bar2Bg.Position = bar2Pos
                            d.Bar2Fill.Visible = true
                            d.Bar2Fill.Size = Vector2.new(Config.BarWidth * pct2, Config.BarHeight)
                            d.Bar2Fill.Position = bar2Pos
                            d.Bar2Fill.Color = color2

                            if Config.ShowValues then
                                d.Bar2Text.Visible = true
                                d.Bar2Text.Text = string.format("%.0f/%.0f", val2, max2)
                                d.Bar2Text.Position = bar2Pos + Vector2.new(Config.BarWidth + 5, -3)
                            else
                                d.Bar2Text.Visible = false
                            end
                            
                            currentY = currentY + Config.BarHeight + 2
                        else
                            d.Bar2Bg.Visible = false
                            d.Bar2Fill.Visible = false
                            d.Bar2Text.Visible = false
                        end
                        
                        -- Health Bar (Bottom)
                        local bar1Pos = Vector2.new(screenPos.X - (Config.BarWidth / 2), currentY)
                        
                        d.Bar1Bg.Visible = true
                        d.Bar1Bg.Size = Vector2.new(Config.BarWidth, Config.BarHeight)
                        d.Bar1Bg.Position = bar1Pos
                        d.Bar1Fill.Visible = true
                        d.Bar1Fill.Size = Vector2.new(Config.BarWidth * pct1, Config.BarHeight)
                        d.Bar1Fill.Position = bar1Pos
                        d.Bar1Fill.Color = color1

                        if Config.ShowValues then
                            d.Bar1Text.Visible = true
                            d.Bar1Text.Text = string.format("%.0f/%.0f", val1, max1)
                            d.Bar1Text.Position = bar1Pos + Vector2.new(Config.BarWidth + 5, -3)
                        else
                            d.Bar1Text.Visible = false
                        end

                    else
                        -- Hide all bars
                        d.Bar1Bg.Visible = false
                        d.Bar1Fill.Visible = false
                        d.Bar1Text.Visible = false
                        d.Bar2Bg.Visible = false
                        d.Bar2Fill.Visible = false
                        d.Bar2Text.Visible = false
                        d.Bar3Bg.Visible = false
                        d.Bar3Fill.Visible = false
                        d.Bar3Text.Visible = false
                    end

                else
                    for _, v in pairs(d) do v.Visible = false end
                end
            end
        end
    end

    for model, entry in pairs(ESP_Cache) do
        if not entry.Seen or not model.Parent then
            RemoveESP(model)
        end
    end
end)

-- Moderator Detector with Sound Notification
-- Detects players with specific roles in Demon Corps North Branch (Group ID: 16346602)
-- Plays Patrick WeeWoo sound when a moderator joins

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local StarterGui = game:GetService("StarterGui")
local SoundService = game:GetService("SoundService")

-- CONFIGURATION
local GROUP_ID = 16346602  -- Demon Corps North Branch Group ID
local MODERATOR_ROLES = {
    ["tes"] = true,
    ["admin"] = true,
    ["Owner"] = true,
}
local ALERT_SOUND_ID = "rbxassetid://427090811"  -- Patrick WeeWoo Loop

-- Track online moderators
local OnlineModerators = {}

-- Function to check if a player is a moderator
local function IsModerator(player)
    local success, role = pcall(function()
        return player:GetRoleInGroup(GROUP_ID)
    end)
    
    if success and role then
        return MODERATOR_ROLES[role] == true, role
    end
    return false, nil
end

-- Function to play alert sound with better reliability
local function PlayAlertSound()
    -- Create a temporary sound object
    local sound = Instance.new("Sound")
    sound.SoundId = ALERT_SOUND_ID
    sound.Volume = 0.8
    sound.PlayOnRemove = false  -- Don't play when removed
    
    -- Parent to something that always exists and can play sounds
    -- Try SoundService first, then workspace as fallback
    if SoundService then
        sound.Parent = SoundService
    else
        sound.Parent = workspace
    end
    
    -- Play the sound
    sound:Play()
    
    -- Print confirmation
    print("üîä Playing alert sound: Patrick WeeWoo")
    
    -- Clean up after sound finishes (plus a small buffer)
    local duration = sound.TimeLength or 5
    task.wait(duration + 1)
    
    -- Safe removal
    if sound and sound.Parent then
        sound:Destroy()
    end
end

-- Alternative method using Instance.new with different parenting
local function PlayAlertSoundAlt()
    -- Try using a different approach - attach to player's character
    local character = LocalPlayer.Character
    if character and character:FindFirstChild("Humanoid") then
        local sound = Instance.new("Sound")
        sound.SoundId = ALERT_SOUND_ID
        sound.Volume = 0.8
        sound.Parent = character
        
        sound:Play()
        print("üîä Playing alert sound (attached to character)")
        
        -- Clean up
        task.wait(sound.TimeLength or 5)
        sound:Destroy()
    else
        -- Fall back to original method
        PlayAlertSound()
    end
end

-- Function to send Roblox-style notification
local function SendNotification(title, text, duration, icon)
    StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 5,
        Icon = icon or "rbxasset://textures/ui/GameSettings/GFX/icon_alert.png"
    })
end

-- Function to check all players on startup
local function CheckExistingPlayers()
    local mods = {}
    local modCount = 0
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local isMod, role = IsModerator(player)
            if isMod then
                mods[player] = role
                OnlineModerators[player] = role
                modCount = modCount + 1
            end
        end
    end
    
    -- Notify about existing moderators
    if modCount > 0 then
        local modNames = {}
        for player, role in pairs(mods) do
            table.insert(modNames, player.Name .. " (" .. role .. ")")
        end
        
        SendNotification(
            "‚ö†Ô∏è Moderators Online",
            table.concat(modNames, "\n"),
            8,
            "rbxasset://textures/ui/GameSettings/GFX/icon_alert.png"
        )
        
        -- Play sound for existing moderators
        PlayAlertSoundAlt()
        
        -- Print to console
        print("‚ö†Ô∏è " .. modCount .. " moderator(s) online at startup")
    end
end

-- Monitor when players join
Players.PlayerAdded:Connect(function(player)
    -- Wait a bit for roles to load
    task.wait(2)
    
    if player ~= LocalPlayer then
        local isMod, role = IsModerator(player)
        if isMod then
            OnlineModerators[player] = role
            
            -- Play the alert sound using the more reliable method
            PlayAlertSoundAlt()
            
            -- Send notification
            SendNotification(
                "‚ö†Ô∏è Moderator Joined",
                player.Name .. " (" .. role .. ") has joined the game!",
                6,
                "rbxasset://textures/ui/GameSettings/GFX/icon_alert.png"
            )
            
            -- Also print to chat/debug
            print("‚ö†Ô∏è MODERATOR JOINED: " .. player.Name .. " (" .. role .. ")")
        end
    end
end)

-- Monitor when players leave
Players.PlayerRemoving:Connect(function(player)
    if OnlineModerators[player] then
        local role = OnlineModerators[player]
        OnlineModerators[player] = nil
        
        -- Send notification (no sound for leaving)
        SendNotification(
            "‚ÑπÔ∏è Moderator Left",
            player.Name .. " (" .. role .. ") has left the game.",
            4,
            "rbxasset://textures/ui/GameSettings/GFX/icon_info.png"
        )
        
        print("‚ÑπÔ∏è MODERATOR LEFT: " .. player.Name .. " (" .. role .. ")")
    end
end)

-- Periodic check (in case role changes during gameplay)
task.spawn(function()
    while task.wait(30) do
        local currentMods = {}
        
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                local isMod, role = IsModerator(player)
                if isMod then
                    currentMods[player] = role
                end
            end
        end
        
        -- Check for new moderators (role changes)
        for player, role in pairs(currentMods) do
            if not OnlineModerators[player] then
                OnlineModerators[player] = role
                
                -- Play sound for role change detection
                PlayAlertSoundAlt()
                
                SendNotification(
                    "‚ö†Ô∏è Moderator Detected",
                    player.Name .. " (" .. role .. ") is now a moderator!",
                    6,
                    "rbxasset://textures/ui/GameSettings/GFX/icon_alert.png"
                )
                
                print("‚ö†Ô∏è NEW MODERATOR DETECTED: " .. player.Name .. " (" .. role .. ")")
            end
        end
        
        -- Check for moderators who lost role
        for player in pairs(OnlineModerators) do
            if not currentMods[player] then
                OnlineModerators[player] = nil
                SendNotification(
                    "‚ÑπÔ∏è Moderator Removed",
                    player.Name .. " is no longer a moderator.",
                    4,
                    "rbxasset://textures/ui/GameSettings/GFX/icon_info.png"
                )
                print("‚ÑπÔ∏è MODERATOR REMOVED: " .. player.Name)
            end
        end
    end
end)

-- Initial check
task.wait(3)
CheckExistingPlayers()

print("‚úÖ Moderator Detector Loaded - Monitoring group " .. GROUP_ID)
print("üîä Alert sound: Patrick WeeWoo (ID: 427090811)")



UserInputService.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.F4 then
        MainFrame.Visible = not MainFrame.Visible
    end
end)

print("Mission Hunter ESP Loaded with Walkspeed Multiplier (Uses WalkSpeed Attribute)")
